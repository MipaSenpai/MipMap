# Система отслеживания батчей

## Что изменилось

Плагин теперь автоматически определяет, когда запускать следующий батч, основываясь на реальных ответах от сервера, а не на фиксированной задержке.

## Как это работает

### 1. BatchTracker (batch_tracker.py)
Новый компонент, который:
- Отслеживает какие чанки должны быть обработаны в текущем батче
- Получает уведомления об успешно отправленных чанках
- Автоматически запускает следующий батч когда все чанки обработаны
- Имеет таймаут защиту (по умолчанию 1200 тиков = 60 секунд)

### 2. Модифицированный ChunkSender
- Теперь отправляет результаты обработки через `result_queue`
- При успешной отправке (HTTP 200) уведомляет основной процесс
- Передает координаты чанка для идентификации

### 3. Обновленный MapLoader
- Убрана фиксированная задержка `batchDelay`
- Регистрирует каждый батч в BatchTracker
- Следующий батч запускается автоматически по callback

### 4. Главный плагин (main.py)
- Создает `result_queue` для получения результатов от ChunkSender
- Запускает задачу `_processResults()` каждый тик для обработки результатов
- Передает результаты в BatchTracker

## Преимущества

✅ **Адаптивность** - работает оптимально на любом железе
✅ **Производительность** - новый батч стартует сразу после обработки предыдущего
✅ **Надежность** - таймаут защищает от зависания
✅ **Прозрачность** - детальное логирование прогресса

## Конфигурация

В `config.toml`:
```toml
[mapLoading]
batchSize = 100        # Размер области в блоках
maxAreas = 10          # Количество областей в одном батче
batchTimeout = 1200    # Максимальное время ожидания батча в тиках (60 сек)
```

### Параметр batchTimeout
- Защита от зависания если чанки не загружаются
- По умолчанию 1200 тиков (60 секунд)
- Можно уменьшить для более быстрого перехода к следующему батчу
- Можно увеличить если сервер медленный

## Логирование

Плагин теперь выводит:
- Количество ожидаемых чанков при старте батча
- Прогресс обработки каждые 10%
- Информацию о завершении батча
- Предупреждения при таймауте
